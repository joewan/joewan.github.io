---
layout: post
title: FMOD Audio Engine 01
---

Cocos2d-x采用OpenAL实现Audio Engine音频引擎，目前项目快上线了，音频引擎依旧有不少奇怪的问题，在iOS和Android平台偶现整个AudioEngine失灵的状况，突然音频就不能播放，而且Cocos2d－x对音频的FadeIn、FadeOut支持的很糟糕。但是我对OpenAL很不熟悉，而且Cocos2d－x音频相关代码在不同平台实现不同，很让人头疼。从产品角度应该继续对OpenAL逐渐修改，不宜做大的重构，但音频相关的代码较复杂，而且以前也没有OpenAL开发相关的经验。以前使用过FMODEx Event System，见识过FMOD的强大，代码质量也很高。因而决定采用FMOD Studio实现重构游戏的音频系统，既可以掌握游戏所有的音频模块，一劳永逸，同时也可以和音频策划配合提高游戏的音效品质。

FMOD的优势：

	1.音频策划可以有完整的工具链支持，提高游戏音效品质
	2.FMOD可以接入定制的Memory管理以及FileSystem（Sync和Async）
	3.FMOD成熟稳定，有诸多成熟案例

### FMOD API

FMOD有2套API: FMOD Low Level API和FMOD Studio API。在2者之间曾经还有过FMOD EventSystem API。FMOD Low Level API可以支持原始音频文件（例如mp3，ogg，wav等）。FMOD Low Level API包含如下Classes：System，Sound，Channel，ChannelControl，ChannelGroup，SoundGroup，DSP，DSPConnection，Reverb3D等。

#### FMOD Low Level API —— System

Virtual channels.
These types of voices are the ones you work with using the FMOD::Channel API. The advantage of virtual channels are, unlike older versions of FMOD, you can now play as many sounds as you like without fear of ever running out of voices, or playsound failing. You can also avoid 'channel stealing' if you specify enough virtual voices.

As an example, you can play 1000 sounds at once, even on a 32 channel soundcard.

FMOD will only play the most important/closest/loudest (determined by volume/distance/geometry and priority settings) voices, and the other 968 voices will be virtualized without expense to the CPU. The voice's cursor positions are updated.

When the priority of sounds change or emulated sounds get louder than audible ones, they will swap the actual voice resource over and play the voice from its correct position in time as it should be heard.

What this means is you can play all 1000 sounds, if they are scattered around the game world, and as you move around the world you will hear the closest or most important 32, and they will automatically swap in and out as you move.

Currently the maximum channel limit is 4093.

#### System::attachFileSystem
Function to allow a user to 'piggyback' on FMOD's file reading routines. This allows users to capture data as FMOD reads it, which may be useful for ripping the raw data that FMOD reads for hard to support sources (for example internet streams).

NOTE! Do not use this to 'override' FMOD's file system! That is what setFileSystem is for. This function is purely for 'snooping' and letting FMOD do its own file access, but if you want to capture what FMOD is reading you can do it with this function.

#### System::close
Closes the system object without freeing the object's memory, so the system handle will still be valid.
Closing the output renders objects created with this system object invalid. Make sure any sounds, channelgroups, geometry and dsp objects are released before closing the system object.

#### System::createChannelGroup
Creates a channel group object. These objects can be used to assign channels to for group channel settings, such as volume.
Channel groups are also used for sub-mixing. Any channels that are assigned to a channel group get submixed into that channel group's DSP.

See the channel group class definition for the types of operations that can be performed on 'groups' of channels.
The channel group can for example be used to have 2 seperate groups of master volume, instead of one global master volume.
A channel group can be used for sub-mixing, ie so that a set of channels can be mixed into a channel group, then can have effects applied to it without affecting other channels.

#### System::createSound
Loads a sound into memory, or opens it for streaming.
